<!-- templates/patient.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Patient {{ patient_id }}</title>
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
</head>
<body>
    <h1>Patient {{ patient_id }}</h1>
    <p>Heart Rate: <span id="heart-rate">0</span></p>
    <p>SaO2: <span id="sao2">0</span></p>
    <p>MAP: <span id="map">0</span></p>
    <p>CO: <span id="co">0</span></p>
    <p>RR: <span id="rr">0</span></p>
    <p>etCO2: <span id="etco2">0</span></p>
    <p>Simulation Time: <span id="simulation-time">0</span></p>

    <script>
        const patientId = "{{ patient_id }}";
        const socket = io();

        socket.on('connect', () => {
            console.log('Connected to server');
            // Join a room specific to this patient
            socket.emit('join', patientId);
        });

        socket.on('patient_data', (data) => {
            if (data.patient_id === patientId) {
                document.getElementById('heart-rate').textContent = data.heart_rate.toFixed(2);
                document.getElementById('sao2').textContent = data.SaO2.toFixed(2);
                document.getElementById('map').textContent = data.MAP.toFixed(2);
                document.getElementById('co').textContent = data.CO.toFixed(2);
                document.getElementById('rr').textContent = data.RR.toFixed(2);
                document.getElementById('etco2').textContent = data.etCO2.toFixed(2);
                document.getElementById('simulation-time').textContent = data.time.toFixed(2);
            }
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from server');
        });
    </script>
</body>
</html>